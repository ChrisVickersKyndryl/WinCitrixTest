# There are 3 different server types.
# Each running different services
# Each of the 3 has different service states

#servers_dcc:
#  - 
#  -
#servers_storefront:
#  -
#  -
#servers_pvs:
#  -
#  -

# Create 3 server lists. These can be overridden in the template variables

vars:
  servers_dcc: []
  servers_storefront: []
  servers_pvs: []

tasks:

  - name: Set status
    set_facts:
      service_summary: "All servers working correctly"


  - name: Create temp folder
    file:
      path: /tmp/MyTest
      state: directory
    delegate_to: 127.0.0.1
    run_once: true


  - name: Creating an empty file
    file:
      path: "/tmp/MyTest/MyFile.txt"
      state: touch
    delegate_to: 127.0.0.1
    run_once: true


  - name: Check store_front
    include_tasks: tasks/StoreFront.yml
    loop: "{{ servers_storefront }}"

   - name: check ddc
     include_tasks: - generic.yml
     loop: "{{ dcc_servers }}"

   - name: check pvs
     include_tasks: - generic.yml
     loop: "{{ dcc_servers }}"


  - name: read information from file
    set_fact:
      file_text: "{{ lookup('file', '/tmp/MyTest/MyFile.txt') }}"
    run_once: true
    delegate_to: 127.0.0.1


  # Send email using SMTP
  - name: email information
    mail:
      host: smtprelay.energyaustralia.com.au
      port: 25
      to: Chris Vickers <john.smith@example.com>
      subject: "Server status '{{ service_summary }}'"
      body: '{{ file_text }}'
    delegate_to: localhost
    run_once: true
